import{r as k,w as I,c as i,e as A,u as n,f as W,g as v,j as t,p as a,k as o,z as r,l as _,F as h,q as M,x as C,A as q,B as G,C as J,y as $,D as Q,E as X,b as Y}from"./app-By3IWkgJ.js";import{_ as Z}from"./AuthenticatedLayout-WvZZlO_O.js";import{u as ee}from"./useDragScroll-DxmIaAdi.js";const te={class:"py-12"},se={class:"mx-auto max-w-7xl sm:px-6 lg:px-8"},ae={key:0,class:"mb-4 rounded-md bg-emerald-400/15 p-4 ring-1 ring-emerald-400/20"},ie={class:"text-sm text-emerald-300"},oe={key:1,class:"mb-4 rounded-md bg-red-400/15 p-4 ring-1 ring-red-400/20"},ne={class:"text-sm text-red-300"},le={class:"mb-4 flex flex-wrap items-end gap-4"},re={class:"w-full sm:w-auto"},de=["value"],ue={key:0,class:"w-full sm:w-auto"},me={key:1,class:"w-full sm:w-auto"},pe=["value"],ce={key:2,class:"mb-4 rounded-md bg-red-400/15 p-4 ring-1 ring-red-400/20"},xe={class:"text-sm text-red-300"},ge={key:3,class:"overflow-hidden rounded-2xl bg-white/10 shadow-lg backdrop-blur-md ring-1 ring-white/15"},we={class:"p-4 sm:p-6"},ke={class:"flex flex-wrap items-center justify-between gap-3 mb-4"},ye={class:"text-lg font-medium text-white"},he={class:"flex items-center gap-2"},be=["disabled"],fe={key:0,class:"min-w-full divide-y divide-white/10"},ve={class:"bg-white/5"},_e={key:0,class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-sky-200/60 whitespace-nowrap"},Me={class:"divide-y divide-white/10"},Ce={class:"whitespace-nowrap px-6 py-4 text-sm text-white uppercase"},Ke={class:"whitespace-nowrap px-6 py-4 text-sm text-sky-200/50 uppercase"},Pe={class:"whitespace-nowrap px-6 py-4 text-sm text-sky-200/80 uppercase"},Se={class:"whitespace-nowrap px-6 py-4 text-sm text-sky-200/50 uppercase"},Le={key:0,class:"whitespace-nowrap px-6 py-4 text-sm text-sky-200/50 uppercase"},De={class:"px-6 py-4 text-sm text-sky-200/80 uppercase min-w-[12rem]"},Ue={class:"whitespace-nowrap px-6 py-4"},Re={class:"px-6 py-4 text-sm text-sky-200/50 uppercase min-w-[10rem]"},Ae={key:0,class:"text-sm text-sky-200/50 mt-4"},je={key:4,class:"overflow-hidden rounded-2xl bg-white/10 shadow-lg backdrop-blur-md ring-1 ring-white/15"},Ee={__name:"Index",props:{meetings:Object,meeting:Object,attendances:Array,filters:Object,mpkkList:Array},setup(u){const b=u,x=Q(),g=k(b.filters.meeting_id||""),l=k(b.filters.category||""),m=k(b.filters.mpkk||""),{scrollEl:j,onMouseDown:K,onMouseLeave:P,onMouseUp:S,onMouseMove:L}=ee();function f(){const d={meeting_id:g.value};l.value&&(d.category=l.value),l.value==="mpkk"&&m.value&&(d.mpkk=m.value),Y.get(route("attendances.index"),d,{preserveState:!0,replace:!0})}function F(){l.value="",m.value="",f()}function T(){m.value="",f()}function V(){f()}I(l,d=>{d!=="mpkk"&&(m.value="")});const B={matc:"Cabang",amk:"AMK",wanita:"Wanita Cabang",mpkk:"MPKK"},E={present:"Hadir",absent:"Tidak Hadir",late:"Lewat",excused:"Dimaafkan"},N={present:"bg-emerald-400/15 text-emerald-300 ring-1 ring-emerald-400/20",absent:"bg-red-400/15 text-red-300 ring-1 ring-red-400/20",late:"bg-yellow-400/15 text-yellow-300 ring-1 ring-yellow-400/20",excused:"bg-white/10 text-sky-200 ring-1 ring-white/15"},y=k(!1),p=k("");async function O(){y.value=!0,p.value="";const d=new URLSearchParams({meeting_id:g.value,category:l.value});m.value&&d.set("mpkk",m.value);const e="/export/attendance-pdf?"+d.toString();try{const s=await X.get(e,{responseType:"blob"});if(!(s.headers["content-type"]||"").includes("application/pdf")){const Fe=await s.data.text();p.value="Respons bukan PDF. Sila muat semula halaman dan cuba lagi.";return}const z=s.headers["content-disposition"]||"";let D="kehadiran.pdf";const U=z.match(/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/);U&&(D=U[1].replace(/['"]/g,""));const H=new Blob([s.data],{type:"application/pdf"}),R=window.URL.createObjectURL(H),w=document.createElement("a");w.href=R,w.download=D,document.body.appendChild(w),w.click(),document.body.removeChild(w),window.URL.revokeObjectURL(R)}catch(s){const c=s.response?.status;c===401||c===419?p.value="Sesi anda telah tamat. Sila muat semula halaman dan log masuk semula.":c===403?p.value="Anda tidak dibenarkan memuat turun PDF ini.":c===422?p.value="Parameter tidak sah. Sila pilih mesyuarat dan kategori.":p.value="Gagal muat turun PDF (Ralat "+(c||"rangkaian")+"). Sila cuba lagi."}finally{y.value=!1}}return(d,e)=>(a(),i(h,null,[A(n(W),{title:"Kehadiran"}),A(Z,null,{header:v(()=>[...e[7]||(e[7]=[t("h2",{class:"text-xl font-semibold leading-tight text-white"},"Rekod Kehadiran",-1)])]),default:v(()=>[t("div",te,[t("div",se,[n(x).props.flash.success?(a(),i("div",ae,[t("p",ie,o(n(x).props.flash.success),1)])):r("",!0),n(x).props.flash.error?(a(),i("div",oe,[t("p",ne,o(n(x).props.flash.error),1)])):r("",!0),t("div",le,[t("div",re,[e[9]||(e[9]=t("label",{class:"block text-sm font-medium text-sky-100/80 mb-1"},"Pilih Mesyuarat",-1)),_(t("select",{"onUpdate:modelValue":e[0]||(e[0]=s=>g.value=s),onChange:F,class:"w-full rounded-md border-0 bg-white/10 text-white ring-1 ring-white/15 focus:ring-2 focus:ring-sky-400 sm:min-w-[20rem]"},[e[8]||(e[8]=t("option",{value:"",class:"bg-sky-900 text-white"},"-- Pilih Mesyuarat --",-1)),(a(!0),i(h,null,M(u.meetings.data,s=>(a(),i("option",{key:s.id,value:s.id,class:"bg-sky-900 text-white"},o(s.title)+" ("+o(s.date)+") ",9,de))),128))],544),[[C,g.value]])]),g.value?(a(),i("div",ue,[e[11]||(e[11]=t("label",{class:"block text-sm font-medium text-sky-100/80 mb-1"},"Kategori",-1)),_(t("select",{"onUpdate:modelValue":e[1]||(e[1]=s=>l.value=s),onChange:T,class:"w-full rounded-md border-0 bg-white/10 text-white ring-1 ring-white/15 focus:ring-2 focus:ring-sky-400 sm:w-48"},[...e[10]||(e[10]=[t("option",{value:"",class:"bg-sky-900 text-white"},"Semua",-1),t("option",{value:"matc",class:"bg-sky-900 text-white"},"Cabang",-1),t("option",{value:"wanita",class:"bg-sky-900 text-white"},"Wanita Cabang",-1),t("option",{value:"amk",class:"bg-sky-900 text-white"},"AMK",-1),t("option",{value:"mpkk",class:"bg-sky-900 text-white"},"MPKK",-1)])],544),[[C,l.value]])])):r("",!0),l.value==="mpkk"?(a(),i("div",me,[e[13]||(e[13]=t("label",{class:"block text-sm font-medium text-sky-100/80 mb-1"},"MPKK",-1)),_(t("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>m.value=s),onChange:V,class:"w-full rounded-md border-0 bg-white/10 text-white ring-1 ring-white/15 focus:ring-2 focus:ring-sky-400 sm:w-64"},[e[12]||(e[12]=t("option",{value:"",class:"bg-sky-900 text-white"},"Semua MPKK",-1)),(a(!0),i(h,null,M(u.mpkkList,s=>(a(),i("option",{key:s,value:s,class:"bg-sky-900 text-white"},o(s),9,pe))),128))],544),[[C,m.value]])])):r("",!0)]),p.value?(a(),i("div",ce,[t("p",xe,o(p.value),1)])):r("",!0),u.meeting?(a(),i("div",ge,[t("div",we,[t("div",ke,[t("h3",ye,o(u.meeting.title),1),t("div",he,[l.value?(a(),i("button",{key:0,onClick:O,disabled:y.value,class:"inline-flex items-center rounded-md bg-emerald-600 px-3 py-2 text-sm font-semibold text-white shadow-lg shadow-emerald-600/30 hover:bg-emerald-500 disabled:opacity-50 disabled:cursor-wait"},o(y.value?"Memuat turun...":"Muat Turun PDF"),9,be)):r("",!0),n(x).props.auth.user.is_admin?(a(),q(n(G),{key:1,href:d.route("attendances.mark",u.meeting.id),class:"inline-flex items-center rounded-md bg-sky-500 px-3 py-2 text-sm font-semibold text-white shadow-lg shadow-sky-500/30 hover:bg-sky-400"},{default:v(()=>[...e[14]||(e[14]=[J(" Rekod Kehadiran ",-1)])]),_:1},8,["href"])):r("",!0)])]),t("div",{ref_key:"scrollEl",ref:j,class:"overflow-x-auto cursor-grab",onMousedown:e[3]||(e[3]=(...s)=>n(K)&&n(K)(...s)),onMouseleave:e[4]||(e[4]=(...s)=>n(P)&&n(P)(...s)),onMouseup:e[5]||(e[5]=(...s)=>n(S)&&n(S)(...s)),onMousemove:e[6]||(e[6]=(...s)=>n(L)&&n(L)(...s))},[u.attendances.length?(a(),i("table",fe,[t("thead",ve,[t("tr",null,[e[15]||(e[15]=t("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-sky-200/60 whitespace-nowrap"},"Nama Ahli",-1)),e[16]||(e[16]=t("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-sky-200/60 whitespace-nowrap"},"No. IC",-1)),e[17]||(e[17]=t("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-sky-200/60 whitespace-nowrap"},"Kategori",-1)),e[18]||(e[18]=t("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-sky-200/60 whitespace-nowrap"},"Jawatan",-1)),l.value==="mpkk"?(a(),i("th",_e,"MPKK")):r("",!0),e[19]||(e[19]=t("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-sky-200/60 whitespace-nowrap"},"Alamat",-1)),e[20]||(e[20]=t("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-sky-200/60 whitespace-nowrap"},"Status",-1)),e[21]||(e[21]=t("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-sky-200/60 whitespace-nowrap"},"Sebab",-1))])]),t("tbody",Me,[(a(!0),i(h,null,M(u.attendances,s=>(a(),i("tr",{key:s.id,class:"hover:bg-white/5"},[t("td",Ce,o(s.member?.name),1),t("td",Ke,o(s.member?.ic_number),1),t("td",Pe,o(s.member?.category_type==="mpkk"?s.member?.position_name||"MPKK":B[s.member?.category_type]||"-"),1),t("td",Se,o(s.member?.position_type||"-"),1),l.value==="mpkk"?(a(),i("td",Le,o(s.member?.position_name||"-"),1)):r("",!0),t("td",De,o(s.member?.address||"-"),1),t("td",Ue,[t("span",{class:$(["inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium",N[s.status]||"bg-white/10 text-sky-200 ring-1 ring-white/15"])},o(E[s.status]||s.status),3)]),t("td",Re,o(s.status==="absent"&&s.absence_reason||"-"),1)]))),128))])])):r("",!0)],544),u.attendances.length?r("",!0):(a(),i("p",Ae,"Tiada rekod kehadiran untuk mesyuarat ini."))])])):(a(),i("div",je,[...e[22]||(e[22]=[t("div",{class:"p-6 text-center text-sm text-sky-200/50"}," Sila pilih mesyuarat untuk melihat rekod kehadiran. ",-1)])]))])])]),_:1})],64))}};export{Ee as default};
