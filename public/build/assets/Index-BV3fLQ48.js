import{r as h,w as I,c as i,e as A,u as n,f as J,g as C,j as s,p as a,k as o,z as r,l as K,F as v,q as P,x as S,A as W,B as q,C as G,y as $,D as Q,E as X,b as Y}from"./app-C1iVb8hG.js";import{_ as Z}from"./AuthenticatedLayout-utReea1L.js";import{u as ee}from"./useDragScroll-CEkLQCwD.js";const te={class:"py-12"},se={class:"mx-auto max-w-7xl sm:px-6 lg:px-8"},ae={key:0,class:"mb-4 rounded-md bg-emerald-400/15 p-4 ring-1 ring-emerald-400/20"},ie={class:"text-sm text-emerald-300"},oe={key:1,class:"mb-4 rounded-md bg-red-400/15 p-4 ring-1 ring-red-400/20"},ne={class:"text-sm text-red-300"},le={class:"mb-4 flex flex-wrap items-end gap-4"},re={class:"w-full sm:w-auto"},de=["value"],ue={key:0,class:"w-full sm:w-auto"},me={key:1,class:"w-full sm:w-auto"},pe=["value"],ce={key:2,class:"mb-4 rounded-md bg-red-400/15 p-4 ring-1 ring-red-400/20"},xe={class:"text-sm text-red-300"},ge={key:3,class:"overflow-hidden rounded-2xl bg-white/10 shadow-lg backdrop-blur-md ring-1 ring-white/15"},we={class:"p-4 sm:p-6"},ke={class:"flex flex-wrap items-center justify-between gap-3 mb-4"},ye={class:"text-lg font-medium text-white"},he={class:"flex items-center gap-2"},fe=["disabled"],be={key:0,class:"min-w-full divide-y divide-white/10"},ve={class:"bg-white/5"},_e={key:0,class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-sky-200/60 whitespace-nowrap"},Me={class:"divide-y divide-white/10"},Ce={class:"whitespace-nowrap px-6 py-4 text-sm text-white uppercase"},Ke={class:"whitespace-nowrap px-6 py-4 text-sm text-sky-200/50 uppercase"},Pe={class:"whitespace-nowrap px-6 py-4 text-sm text-sky-200/80 uppercase"},Se={class:"whitespace-nowrap px-6 py-4 text-sm text-sky-200/50 uppercase"},Le={key:0,class:"whitespace-nowrap px-6 py-4 text-sm text-sky-200/50 uppercase"},je={class:"px-6 py-4 text-sm text-sky-200/80 uppercase min-w-[12rem]"},De={class:"whitespace-nowrap px-6 py-4"},Re={class:"px-6 py-4 text-sm text-sky-200/50 uppercase min-w-[10rem]"},Ue={key:0,class:"text-sm text-sky-200/50 mt-4"},Ae={key:4,class:"overflow-hidden rounded-2xl bg-white/10 shadow-lg backdrop-blur-md ring-1 ring-white/15"},Te={__name:"Index",props:{meetings:Object,meeting:Object,attendances:Array,filters:Object,mpkkList:Array},setup(u){const _=u,w=Q(),k=h(_.filters.meeting_id||""),l=h(_.filters.category||""),m=h(_.filters.mpkk||""),{scrollEl:B,onMouseDown:L,onMouseLeave:j,onMouseUp:D,onMouseMove:R}=ee();function M(){const d={meeting_id:k.value};l.value&&(d.category=l.value),l.value==="mpkk"&&m.value&&(d.mpkk=m.value),Y.get(route("attendances.index"),d,{preserveState:!0,replace:!0})}function F(){l.value="",m.value="",M()}function N(){m.value="",M()}function O(){M()}I(l,d=>{d!=="mpkk"&&(m.value="")});const T={matc:"Cabang",amk:"AMK",wanita:"Wanita Cabang",mpkk:"MPKK"},V={present:"Hadir",absent:"Tidak Hadir",late:"Lewat",excused:"Dimaafkan"},E={present:"bg-emerald-400/15 text-emerald-300 ring-1 ring-emerald-400/20",absent:"bg-red-400/15 text-red-300 ring-1 ring-red-400/20",late:"bg-yellow-400/15 text-yellow-300 ring-1 ring-yellow-400/20",excused:"bg-white/10 text-sky-200 ring-1 ring-white/15"},f=h(!1),p=h("");async function z(){f.value=!0,p.value="";const d=new URLSearchParams({meeting_id:k.value,category:l.value});m.value&&d.set("mpkk",m.value);const e="/export/attendance-pdf?"+d.toString();try{const t=await X.get(e,{responseType:"blob"});if(!(t.headers["content-type"]||"").includes("application/pdf")){const Be=await t.data.text();p.value="Respons bukan PDF. Sila muat semula halaman dan cuba lagi.";return}const g=t.headers["content-disposition"]||"";let b="kehadiran.pdf";const c=g.match(/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/);c&&(b=c[1].replace(/['"]/g,""));const H=new Blob([t.data],{type:"application/pdf"}),U=window.URL.createObjectURL(H),y=document.createElement("a");y.href=U,y.download=b,document.body.appendChild(y),y.click(),document.body.removeChild(y),window.URL.revokeObjectURL(U)}catch(t){const x=t.response?.status;let g="";if(t.response?.data instanceof Blob)try{const b=await t.response.data.text(),c=JSON.parse(b);c.errors?g=Object.values(c.errors).flat().join(", "):c.message&&(g=c.message)}catch{}x===401||x===419?p.value="Sesi anda telah tamat. Sila muat semula halaman dan log masuk semula.":x===403?p.value="Anda tidak dibenarkan memuat turun PDF ini.":x===422?p.value="Ralat pengesahan: "+(g||"Parameter tidak sah."):p.value="Gagal muat turun PDF (Ralat "+(x||"rangkaian")+"). "+(g||"Sila cuba lagi.")}finally{f.value=!1}}return(d,e)=>(a(),i(v,null,[A(n(J),{title:"Kehadiran"}),A(Z,null,{header:C(()=>[...e[7]||(e[7]=[s("h2",{class:"text-xl font-semibold leading-tight text-white"},"Rekod Kehadiran",-1)])]),default:C(()=>[s("div",te,[s("div",se,[n(w).props.flash.success?(a(),i("div",ae,[s("p",ie,o(n(w).props.flash.success),1)])):r("",!0),n(w).props.flash.error?(a(),i("div",oe,[s("p",ne,o(n(w).props.flash.error),1)])):r("",!0),s("div",le,[s("div",re,[e[9]||(e[9]=s("label",{class:"block text-sm font-medium text-sky-100/80 mb-1"},"Pilih Mesyuarat",-1)),K(s("select",{"onUpdate:modelValue":e[0]||(e[0]=t=>k.value=t),onChange:F,class:"w-full rounded-md border-0 bg-white/10 text-white ring-1 ring-white/15 focus:ring-2 focus:ring-sky-400 sm:min-w-[20rem]"},[e[8]||(e[8]=s("option",{value:"",class:"bg-sky-900 text-white"},"-- Pilih Mesyuarat --",-1)),(a(!0),i(v,null,P(u.meetings.data,t=>(a(),i("option",{key:t.id,value:t.id,class:"bg-sky-900 text-white"},o(t.title)+" ("+o(t.date)+") ",9,de))),128))],544),[[S,k.value]])]),k.value?(a(),i("div",ue,[e[11]||(e[11]=s("label",{class:"block text-sm font-medium text-sky-100/80 mb-1"},"Kategori",-1)),K(s("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>l.value=t),onChange:N,class:"w-full rounded-md border-0 bg-white/10 text-white ring-1 ring-white/15 focus:ring-2 focus:ring-sky-400 sm:w-48"},[...e[10]||(e[10]=[s("option",{value:"",class:"bg-sky-900 text-white"},"Semua",-1),s("option",{value:"matc",class:"bg-sky-900 text-white"},"Cabang",-1),s("option",{value:"wanita",class:"bg-sky-900 text-white"},"Wanita Cabang",-1),s("option",{value:"amk",class:"bg-sky-900 text-white"},"AMK",-1),s("option",{value:"mpkk",class:"bg-sky-900 text-white"},"MPKK",-1)])],544),[[S,l.value]])])):r("",!0),l.value==="mpkk"?(a(),i("div",me,[e[13]||(e[13]=s("label",{class:"block text-sm font-medium text-sky-100/80 mb-1"},"MPKK",-1)),K(s("select",{"onUpdate:modelValue":e[2]||(e[2]=t=>m.value=t),onChange:O,class:"w-full rounded-md border-0 bg-white/10 text-white ring-1 ring-white/15 focus:ring-2 focus:ring-sky-400 sm:w-64"},[e[12]||(e[12]=s("option",{value:"",class:"bg-sky-900 text-white"},"Semua MPKK",-1)),(a(!0),i(v,null,P(u.mpkkList,t=>(a(),i("option",{key:t,value:t,class:"bg-sky-900 text-white"},o(t),9,pe))),128))],544),[[S,m.value]])])):r("",!0)]),p.value?(a(),i("div",ce,[s("p",xe,o(p.value),1)])):r("",!0),u.meeting?(a(),i("div",ge,[s("div",we,[s("div",ke,[s("h3",ye,o(u.meeting.title),1),s("div",he,[l.value?(a(),i("button",{key:0,onClick:z,disabled:f.value,class:"inline-flex items-center rounded-md bg-emerald-600 px-3 py-2 text-sm font-semibold text-white shadow-lg shadow-emerald-600/30 hover:bg-emerald-500 disabled:opacity-50 disabled:cursor-wait"},o(f.value?"Memuat turun...":"Muat Turun PDF"),9,fe)):r("",!0),n(w).props.auth.user.is_admin?(a(),W(n(q),{key:1,href:d.route("attendances.mark",u.meeting.id),class:"inline-flex items-center rounded-md bg-sky-500 px-3 py-2 text-sm font-semibold text-white shadow-lg shadow-sky-500/30 hover:bg-sky-400"},{default:C(()=>[...e[14]||(e[14]=[G(" Rekod Kehadiran ",-1)])]),_:1},8,["href"])):r("",!0)])]),s("div",{ref_key:"scrollEl",ref:B,class:"overflow-x-auto cursor-grab",onMousedown:e[3]||(e[3]=(...t)=>n(L)&&n(L)(...t)),onMouseleave:e[4]||(e[4]=(...t)=>n(j)&&n(j)(...t)),onMouseup:e[5]||(e[5]=(...t)=>n(D)&&n(D)(...t)),onMousemove:e[6]||(e[6]=(...t)=>n(R)&&n(R)(...t))},[u.attendances.length?(a(),i("table",be,[s("thead",ve,[s("tr",null,[e[15]||(e[15]=s("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-sky-200/60 whitespace-nowrap"},"Nama Ahli",-1)),e[16]||(e[16]=s("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-sky-200/60 whitespace-nowrap"},"No. IC",-1)),e[17]||(e[17]=s("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-sky-200/60 whitespace-nowrap"},"Kategori",-1)),e[18]||(e[18]=s("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-sky-200/60 whitespace-nowrap"},"Jawatan",-1)),l.value==="mpkk"?(a(),i("th",_e,"MPKK")):r("",!0),e[19]||(e[19]=s("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-sky-200/60 whitespace-nowrap"},"Alamat",-1)),e[20]||(e[20]=s("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-sky-200/60 whitespace-nowrap"},"Status",-1)),e[21]||(e[21]=s("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-sky-200/60 whitespace-nowrap"},"Sebab",-1))])]),s("tbody",Me,[(a(!0),i(v,null,P(u.attendances,t=>(a(),i("tr",{key:t.id,class:"hover:bg-white/5"},[s("td",Ce,o(t.member?.name),1),s("td",Ke,o(t.member?.ic_number),1),s("td",Pe,o(t.member?.category_type==="mpkk"?t.member?.position_name||"MPKK":T[t.member?.category_type]||"-"),1),s("td",Se,o(t.member?.position_type||"-"),1),l.value==="mpkk"?(a(),i("td",Le,o(t.member?.position_name||"-"),1)):r("",!0),s("td",je,o(t.member?.address||"-"),1),s("td",De,[s("span",{class:$(["inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium",E[t.status]||"bg-white/10 text-sky-200 ring-1 ring-white/15"])},o(V[t.status]||t.status),3)]),s("td",Re,o(t.status==="absent"&&t.absence_reason||"-"),1)]))),128))])])):r("",!0)],544),u.attendances.length?r("",!0):(a(),i("p",Ue,"Tiada rekod kehadiran untuk mesyuarat ini."))])])):(a(),i("div",Ae,[...e[22]||(e[22]=[s("div",{class:"p-6 text-center text-sm text-sky-200/50"}," Sila pilih mesyuarat untuk melihat rekod kehadiran. ",-1)])]))])])]),_:1})],64))}};export{Te as default};
