import{r as g,w as B,c as n,e as M,u as o,f as $,g as b,j as s,p as a,k as r,z as d,l as L,m as q,x as F,F as k,q as S,B as C,C as T,A as N,y as G,b as V,D as Q,E as X}from"./app-C1iVb8hG.js";import{_ as Y}from"./AuthenticatedLayout-utReea1L.js";import{u as Z}from"./useDragScroll-CEkLQCwD.js";const ee={class:"flex items-center justify-between"},te={class:"py-12"},se={class:"mx-auto max-w-7xl sm:px-6 lg:px-8"},ae={key:0,class:"mb-4 rounded-md bg-emerald-400/15 p-4 ring-1 ring-emerald-400/20"},oe={class:"text-sm text-emerald-300"},ne={key:1,class:"mb-4 rounded-md bg-red-400/15 p-4 ring-1 ring-red-400/20"},ie={class:"text-sm text-red-300"},le={key:2,class:"mb-4 rounded-md bg-red-400/15 p-4 ring-1 ring-red-400/20"},re={class:"text-sm text-red-300"},de={class:"mb-4 flex flex-wrap items-end gap-4"},ue={class:"w-full sm:w-auto"},pe={class:"w-full sm:w-auto"},ce={key:0,class:"w-full sm:w-auto"},me=["value"],xe=["disabled"],he={class:"overflow-hidden rounded-2xl bg-white/10 shadow-lg backdrop-blur-md ring-1 ring-white/15"},ye={class:"min-w-full divide-y divide-white/10"},ke={class:"bg-white/5"},we={key:0,class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-sky-200/60 whitespace-nowrap"},fe={class:"divide-y divide-white/10"},ge={class:"whitespace-nowrap px-6 py-4 uppercase"},be={class:"whitespace-nowrap px-6 py-4 text-sm text-sky-200/50 uppercase"},ve={class:"whitespace-nowrap px-6 py-4"},_e={class:"inline-flex items-center rounded-full bg-sky-400/15 px-2.5 py-0.5 text-xs font-medium text-sky-300 ring-1 ring-sky-400/20 uppercase"},Me={class:"whitespace-nowrap px-6 py-4 text-sm text-sky-200/50 uppercase"},Ce={key:0,class:"whitespace-nowrap px-6 py-4 text-sm text-sky-200/50 uppercase"},Ke={class:"whitespace-nowrap px-6 py-4 text-sm text-sky-200/50 uppercase"},Pe={class:"px-6 py-4 text-sm text-sky-200/50 uppercase min-w-[12rem]"},Le={class:"whitespace-nowrap px-6 py-4 text-right text-sm"},Se=["onClick"],Te={key:0},je=["colspan"],Ue={key:3,class:"mt-4 flex justify-center"},Ae=["innerHTML"],Fe={__name:"Index",props:{members:Object,filters:Object,mpkkList:Array},setup(x){const K=x,h=Q(),w=g(K.filters.search||""),l=g(K.filters.category||""),u=g(K.filters.mpkk||""),{scrollEl:E,onMouseDown:j,onMouseLeave:U,onMouseUp:A,onMouseMove:D}=Z();function P(){const i={};w.value&&(i.search=w.value),l.value&&(i.category=l.value),l.value==="mpkk"&&u.value&&(i.mpkk=u.value),V.get(route("members.index"),i,{preserveState:!0,replace:!0})}B(w,()=>P());function O(){u.value="",P()}function H(){P()}B(l,i=>{i!=="mpkk"&&(u.value="")});function z(i){confirm("Adakah anda pasti mahu memadam ahli ini?")&&V.delete(route("members.destroy",i))}const I={matc:"Cabang",amk:"AMK",wanita:"Wanita Cabang",mpkk:"MPKK"},v=g(!1),p=g("");async function J(){v.value=!0,p.value="";const i=new URLSearchParams({category:l.value});u.value&&i.set("mpkk",u.value);const t="/export/members-pdf?"+i.toString();try{const e=await X.get(t,{responseType:"blob"});if(!(e.headers["content-type"]||"").includes("application/pdf")){p.value="Respons bukan PDF. Sila muat semula halaman dan cuba lagi.";return}const y=e.headers["content-disposition"]||"";let _="ahli.pdf";const m=y.match(/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/);m&&(_=m[1].replace(/['"]/g,""));const W=new Blob([e.data],{type:"application/pdf"}),R=window.URL.createObjectURL(W),f=document.createElement("a");f.href=R,f.download=_,document.body.appendChild(f),f.click(),document.body.removeChild(f),window.URL.revokeObjectURL(R)}catch(e){const c=e.response?.status;let y="";if(e.response?.data instanceof Blob)try{const _=await e.response.data.text(),m=JSON.parse(_);m.errors?y=Object.values(m.errors).flat().join(", "):m.message&&(y=m.message)}catch{}c===401||c===419?p.value="Sesi anda telah tamat. Sila muat semula halaman dan log masuk semula.":c===403?p.value="Anda tidak dibenarkan memuat turun PDF ini.":c===422?p.value="Ralat pengesahan: "+(y||"Parameter tidak sah."):p.value="Gagal muat turun PDF (Ralat "+(c||"rangkaian")+"). "+(y||"Sila cuba lagi.")}finally{v.value=!1}}return(i,t)=>(a(),n(k,null,[M(o($),{title:"Ahli"}),M(Y,null,{header:b(()=>[s("div",ee,[t[8]||(t[8]=s("h2",{class:"text-xl font-semibold leading-tight text-white"},"Senarai Ahli",-1)),o(h).props.auth.user.is_admin?(a(),N(o(C),{key:0,href:i.route("members.create"),class:"inline-flex items-center rounded-md bg-sky-500 px-3 py-2 text-sm font-semibold text-white shadow-lg shadow-sky-500/30 hover:bg-sky-400"},{default:b(()=>[...t[7]||(t[7]=[T(" Tambah Ahli ",-1)])]),_:1},8,["href"])):d("",!0)])]),default:b(()=>[s("div",te,[s("div",se,[o(h).props.flash.success?(a(),n("div",ae,[s("p",oe,r(o(h).props.flash.success),1)])):d("",!0),o(h).props.flash.error?(a(),n("div",ne,[s("p",ie,r(o(h).props.flash.error),1)])):d("",!0),p.value?(a(),n("div",le,[s("p",re,r(p.value),1)])):d("",!0),s("div",de,[s("div",ue,[t[9]||(t[9]=s("label",{class:"block text-sm font-medium text-sky-100/80 mb-1"},"Cari",-1)),L(s("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>w.value=e),type:"text",placeholder:"Cari ahli...",class:"w-full rounded-md border-0 bg-white/10 text-white ring-1 ring-white/15 placeholder-sky-200/40 focus:ring-2 focus:ring-sky-400 sm:w-64"},null,512),[[q,w.value]])]),s("div",pe,[t[11]||(t[11]=s("label",{class:"block text-sm font-medium text-sky-100/80 mb-1"},"Kategori",-1)),L(s("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>l.value=e),onChange:O,class:"w-full rounded-md border-0 bg-white/10 text-white ring-1 ring-white/15 focus:ring-2 focus:ring-sky-400 sm:w-48"},[...t[10]||(t[10]=[s("option",{value:"",class:"bg-sky-900 text-white"},"Semua",-1),s("option",{value:"matc",class:"bg-sky-900 text-white"},"Cabang",-1),s("option",{value:"wanita",class:"bg-sky-900 text-white"},"Wanita Cabang",-1),s("option",{value:"amk",class:"bg-sky-900 text-white"},"AMK",-1),s("option",{value:"mpkk",class:"bg-sky-900 text-white"},"MPKK",-1)])],544),[[F,l.value]])]),l.value==="mpkk"?(a(),n("div",ce,[t[13]||(t[13]=s("label",{class:"block text-sm font-medium text-sky-100/80 mb-1"},"MPKK",-1)),L(s("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>u.value=e),onChange:H,class:"w-full rounded-md border-0 bg-white/10 text-white ring-1 ring-white/15 focus:ring-2 focus:ring-sky-400 sm:w-64"},[t[12]||(t[12]=s("option",{value:"",class:"bg-sky-900 text-white"},"Semua MPKK",-1)),(a(!0),n(k,null,S(x.mpkkList,e=>(a(),n("option",{key:e,value:e,class:"bg-sky-900 text-white"},r(e),9,me))),128))],544),[[F,u.value]])])):d("",!0),l.value?(a(),n("button",{key:1,onClick:J,disabled:v.value,class:"inline-flex items-center rounded-md bg-emerald-600 px-3 py-2 text-sm font-semibold text-white shadow-lg shadow-emerald-600/30 hover:bg-emerald-500 disabled:opacity-50 disabled:cursor-wait"},r(v.value?"Memuat turun...":"Muat Turun PDF"),9,xe)):d("",!0)]),s("div",he,[s("div",{ref_key:"scrollEl",ref:E,class:"overflow-x-auto cursor-grab",onMousedown:t[3]||(t[3]=(...e)=>o(j)&&o(j)(...e)),onMouseleave:t[4]||(t[4]=(...e)=>o(U)&&o(U)(...e)),onMouseup:t[5]||(t[5]=(...e)=>o(A)&&o(A)(...e)),onMousemove:t[6]||(t[6]=(...e)=>o(D)&&o(D)(...e))},[s("table",ye,[s("thead",ke,[s("tr",null,[t[14]||(t[14]=s("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-sky-200/60 whitespace-nowrap"},"Nama",-1)),t[15]||(t[15]=s("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-sky-200/60 whitespace-nowrap"},"No. IC",-1)),t[16]||(t[16]=s("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-sky-200/60 whitespace-nowrap"},"Kategori",-1)),t[17]||(t[17]=s("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-sky-200/60 whitespace-nowrap"},"Jawatan",-1)),l.value==="mpkk"?(a(),n("th",we,"MPKK")):d("",!0),t[18]||(t[18]=s("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-sky-200/60 whitespace-nowrap"},"Telefon",-1)),t[19]||(t[19]=s("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-sky-200/60 whitespace-nowrap"},"Alamat",-1)),t[20]||(t[20]=s("th",{class:"px-6 py-3 text-right text-xs font-medium uppercase tracking-wider text-sky-200/60 whitespace-nowrap"},"Tindakan",-1))])]),s("tbody",fe,[(a(!0),n(k,null,S(x.members.data,e=>(a(),n("tr",{key:e.id,class:"hover:bg-white/5"},[s("td",ge,[M(o(C),{href:i.route("members.show",e.id),class:"text-sky-300 hover:text-sky-200"},{default:b(()=>[T(r(e.name),1)]),_:2},1032,["href"])]),s("td",be,r(e.ic_number),1),s("td",ve,[s("span",_e,r(e.category_type==="mpkk"?e.position_name||"MPKK":I[e.category_type]||e.category_type),1)]),s("td",Me,r(e.position_type||"-"),1),l.value==="mpkk"?(a(),n("td",Ce,r(e.position_name||"-"),1)):d("",!0),s("td",Ke,r(e.phone_number),1),s("td",Pe,r(e.address||"-"),1),s("td",Le,[o(h).props.auth.user.is_admin?(a(),n(k,{key:0},[M(o(C),{href:i.route("members.edit",e.id),class:"text-sky-300 hover:text-sky-200 mr-3"},{default:b(()=>[...t[21]||(t[21]=[T("Ubah",-1)])]),_:1},8,["href"]),s("button",{onClick:c=>z(e.id),class:"text-red-300 hover:text-red-200"},"Padam",8,Se)],64)):d("",!0)])]))),128)),x.members.data.length?d("",!0):(a(),n("tr",Te,[s("td",{colspan:l.value==="mpkk"?8:7,class:"px-6 py-4 text-center text-sm text-sky-200/50"},"Tiada ahli dijumpai.",8,je)]))])])],544)]),x.members.links.length>3?(a(),n("div",Ue,[(a(!0),n(k,null,S(x.members.links,e=>(a(),n(k,{key:e.label},[e.url?(a(),N(o(C),{key:0,href:e.url,innerHTML:e.label,class:G(["mx-1 rounded border px-3 py-1 text-sm",e.active?"bg-sky-500 text-white border-sky-500":"bg-white/10 text-sky-100 border-white/15 hover:bg-white/20"])},null,8,["href","innerHTML","class"])):(a(),n("span",{key:1,innerHTML:e.label,class:"mx-1 rounded border border-white/10 bg-white/5 px-3 py-1 text-sm text-sky-300/40"},null,8,Ae))],64))),128))])):d("",!0)])])]),_:1})],64))}};export{Fe as default};
